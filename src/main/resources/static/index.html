<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>Demo</title>
    <meta name="description" content=""/>
    <meta name="viewport" content="width=device-width"/>
    <base href="/"/>
    <link rel="stylesheet" type="text/css" href="/webjars/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="webjars/salesforce-lightning-design-system/2.1.4/assets/styles/salesforce-lightning-design-system.min.css"/>
    
    <script type="text/javascript" src="/webjars/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="/webjars/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/webjars/js-cookie/js.cookie.js"></script>
    
</head>
<body>
	<h1>Demo</h1>	
	<div class="container unauthenticated">
	    With Salesforce: <a href="/login">click here</a>
	</div>
	<div class="container authenticated" style="display:none">
	  Logged in as: <span id="user"></span>
	  <div>
	    <button onClick="logout()" class="slds-button  slds-button--brand">Logout</button>
	    <button onClick="getAccounts()" class="slds-button  slds-button--brand">accounts</button>
	  </div>
	
		<div class="slds-container--center slds-container--medium" style="margin-top: 60px;">
	        <div class="slds-text-heading--medium">Salesforce Accounts</div>
	
	        <table class="slds-table slds-table--bordered slds-table--cell-buffer">
	            <thead>
	                <tr class="slds-text-title--caps">
	                    <th scope="col">
	                        <div class="slds-truncate" title="Id">Id</div>
	                    </th>
	                    <th scope="col">
	                        <div class="slds-truncate" title="Id">Name</div>
	                    </th>
	                    <th scope="col">
	                        <div class="slds-truncate" title="Id">Industry</div>
	                    </th>
	                    <th scope="col">
	                        <div class="slds-truncate" title="Id">Rating</div>
	                    </th>
	                </tr>
	            </thead>
	            <tbody>
	            </tbody>
	        </table>
	    </div>
	</div>
	<script type="text/javascript">
	    $.get("/user", function(data) {
	        $("#user").html(data.userAuthentication.details.name);
	        $(".unauthenticated").hide()
	        $(".authenticated").show()
	    });
	    
	    var logout = function() {
	        $.post("/logout", function() {
	            $("#user").html('');
	            $(".unauthenticated").show();
	            $(".authenticated").hide();
	        })
	        return true;
	    }
	    var getAccounts = function() {
	          $.get("/accounts", function(data) {
	            $("tbody").empty();
	            $.each(data, function(i, account) {
	              var tr = $("<tr>");
	              tr.append($("<td>").text(account.Id));
	              tr.append($("<td>").text(account.Name));
	              tr.append($("<td>").text(account.Industry));
	              tr.append($("<td>").text(account.Rating));
	              $("tbody").append(tr);
	            });
	          });
	        };
	    $.ajaxSetup({
	    	beforeSend : function(xhr, settings) {
	    	  if (settings.type == 'POST' || settings.type == 'PUT'
	    	      || settings.type == 'DELETE') {
	    	    if (!(/^http:.*/.test(settings.url) || /^https:.*/
	    	        .test(settings.url))) {
	    	      // Only send the token to relative URLs i.e. locally.
	    	      xhr.setRequestHeader("X-XSRF-TOKEN",
	    	          Cookies.get('XSRF-TOKEN'));
	    	    }
	    	  }
	    	}
	    	});
	</script>
	
</body>
</html>